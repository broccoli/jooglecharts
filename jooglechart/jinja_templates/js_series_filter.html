
		/*
			For the series filter, we will use a category filter.  We
			have to create a special DataTable out of the main data column
			that will be used by the series filter.
			
			The series filter is not bound to data, so it doesn't dirctly
			filter any data.  Instead, it triggers a callback to
			create a new view for redrawing the chart(s).
		*/

		// create the special table that the category filter acts on
	    var columnsTable = new google.visualization.DataTable();
	    columnsTable.addColumn('string', 'colLabel');
	    var initState = {
			selectedValues: []
	    };
		
	    // put the columns into this data table (skip column 0)
		var num_columns = {{ jg.data_name }}.getNumberOfColumns();
		var num_series = 0;
	    for (var i = 1; i < num_columns; i++) {
			
			// TODO: skip role columns (create this table in jooglechart_api with pandas and gviz_api)
			
			num_series += 1;
			columnsTable.addRow([{{ jg.data_name }}.getColumnLabel(i)]);
	    }
	    initState.selectedValues.push({{ jg.data_name }}.getColumnLabel(1));

	    var columnFilter = new google.visualization.ControlWrapper({
	      controlType: 'CategoryFilter',
	      containerId: 'colFilter_div',
	      dataTable: columnsTable,
	      options: {{ jg._series_filter.options|default("{}")|to_json }},
	      state: initState
	    });

	    columnFilter.draw();

	    var columns = [];
	    var series = {};
	    for (var i = 0; i < {{ jg.data_name }}.getNumberOfColumns(); i++) {
	        columns.push(i);
	        if (i > 0) {
	            series[i - 1] = {};
	        }
	    }

		function series_filter_update_chart() {
			
			var selectedValues = columnFilter.getState().selectedValues;
			// loop through number of rows in columnTable
			
			for (var i = 0; i < num_series; i++) {
				test_val = columnsTable.getValue(i, 0);
				
				if ($.inArray(test_val, selectedValues) >= 0) {
					columns[i + 1] = i + 1;
					series[i].color = null;					
				} else {
	                columns[i + 1] = {
	                    label: {{ jg.data_name }}.getColumnLabel(i + 1),
	                    type: {{ jg.data_name }}.getColumnType(i + 1),
	                    calc: function () {
	                        return null;
	                    }
	                };
					series[i].color = '#CCCCCC';
					
				}
			}
            var view = new google.visualization.DataView({{ jg.data_name }});
            view.setColumns(columns);
            
            {% for chart in jg.charts %}
				{{ chart.name }}.setDataTable(view);
				{{ chart.name }}.setOption('series', series);
            {% endfor %}
            {% if jg.filters %}
				{{ jg.dashboard_name }}.draw(view);
            {% else %}
	            {% for chart in jg.charts %}
	            {{ chart.name }}.draw();
	            {% endfor %}
            {% endif %}
			
		}
	    google.visualization.events.addListener(columnFilter, 'statechange', series_filter_update_chart);
		series_filter_update_chart();
